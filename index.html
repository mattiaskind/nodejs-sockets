<!DOCTYPE html>
<html>
  <head>
    <title>Socket.IO chat</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <ul id="messages"></ul>
    <div class="form-container">
      <div class="online">
        Online:
        <ul class="online-list"></ul>
      </div>

      <form id="form">
        <div class="input-field-container">
          <div class="input-field-name">Ditt namn</div>
          <div class="input-field"><input type="text" id="name" class="form-input" /></div>
        </div>

        <div class="input-field-container">
          <div class="input-field-name">Meddelande</div>
          <div class="input-field">
            <input type="text" id="input" autocomplete="off" class="form-input" />
          </div>
        </div>

        <div class="btn-container">
          <button>Skicka</button>
        </div>
      </form>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();

      const form = document.querySelector('form');
      const name = document.querySelector('#name');
      const input = document.querySelector('#input');
      const messages = document.querySelector('#messages');
      const onlineList = document.querySelector('.online-list');

      form.addEventListener('submit', (e) => {
        e.preventDefault();

        if (input.value && name.value) {
          msgData = {
            name: name.value,
            msg: input.value,
          };
          socket.emit('chat-message', msgData);
          input.value = '';
        }
      });

      socket.on('updateUsersList', (users) => {
        const usersHtml = Object.values(users)
          .map((user) => `<li class="user">${user}</li>`)
          .join('');

        onlineList.innerHTML = usersHtml;
      });

      socket.on('chat-message', (msg) => {
        let item = document.createElement('li');
        item.textContent = `${msg.name}: ${msg.msg}`;
        messages.appendChild(item);
        window.scrollTo(0, document.body.scrollHeight);
      });

      socket.on('change', (msg) => {
        let item = document.createElement('li');
        item.textContent = msg;
        item.className = 'event';
        messages.appendChild(item);
      });
    </script>
  </body>
</html>
